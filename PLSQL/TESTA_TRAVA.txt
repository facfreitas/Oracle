-- Rotina para Tratamento de Travamento de Registro

CREATE OR REPLACE PROCEDURE PROCURA
(PI_CODIGO IN CLIENTES.COD_CLI%TYPE
)
IS
 E_EXCECAO    EXCEPTION;
 PRAGMA EXCEPTION_INIT(E_EXCECAO, -54);
 V_CODIGO CLIENTES.COD_CLI%TYPE;
 V_ErrorCode NUMBER;
 V_ErrorMsg VARCHAR2(200);

BEGIN
 SELECT  CLIENTES.COD_CLI
 INTO    
  V_CODIGO
 FROM CLIENTES WHERE CLIENTES.COD_CLI = PI_CODIGO FOR UPDATE NOWAIT;
EXCEPTION
WHEN E_EXCECAO THEN
    v_ErrorCode:=SQLCODE;
    v_ErrorMsg:=SQLERRM;
  DBMS_OUTPUT.PUT_LINE('Registro em Uso! Tente depois...');
  DBMS_OUTPUT.PUT_LINE('Código do Erro: '|| v_ErrorCode);
  DBMS_OUTPUT.PUT_LINE(' Mensagem: ' || v_ErrorMsg);

END;
/
